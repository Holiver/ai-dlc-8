# 实施计划：AWSomeShop 员工福利电商系统

## 概述

本实施计划将AWSomeShop系统的开发分为多个阶段，每个阶段包含可以并行执行的任务组。通过合理的任务分组和并行化，可以显著缩短项目交付时间。

## 任务依赖关系说明

- **串行任务**：必须按顺序执行的任务
- **并行任务组**：标注为 `[并行组 X]` 的任务可以同时执行
- **检查点**：在关键阶段设置检查点，确保所有并行任务完成后再继续

---

## 阶段 1：项目基础设施搭建

### [并行组 1A] - 后端基础设施

- [ ] 1.1 初始化 Go 项目结构
  - 创建项目目录结构（cmd, internal, pkg, configs, migrations）
  - 初始化 go.mod，添加依赖（Gin, GORM, JWT, bcrypt, Viper）
  - 配置项目构建和运行脚本
  - _需求: 所有后端需求的基础_

- [ ] 1.2 配置数据库连接和 GORM
  - 实现数据库连接池配置
  - 配置 GORM 日志和连接参数
  - 实现数据库健康检查
  - _需求: 所有数据持久化需求的基础_

- [ ] 1.3 创建数据库迁移脚本
  - 创建 users 表迁移脚本
  - 创建 products 表迁移脚本
  - 创建 redemption_orders 表迁移脚本
  - 创建 points_transactions 表迁移脚本
  - 创建 product_price_history 表迁移脚本
  - _需求: 1, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14_

### [并行组 1B] - 前端基础设施

- [ ] 1.4 初始化 React 项目
  - 使用 Create React App 或 Vite 创建项目
  - 配置 TypeScript 支持
  - 添加依赖（React Router, Axios, Ant Design, react-i18next）
  - 配置项目构建和开发脚本
  - _需求: 所有前端需求的基础_

- [ ] 1.5 配置前端路由和布局
  - 配置 React Router 路由结构
  - 创建主布局组件（Header, Footer, Content）
  - 实现员工端和管理员端路由分离
  - _需求: 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14_

- [ ] 1.6 配置 Docker 容器化
  - 创建后端 Dockerfile
  - 创建前端 Dockerfile
  - 创建 docker-compose.yml（包含 MySQL, 后端, 前端, Nginx）
  - 配置 Nginx 反向代理
  - _需求: 所有需求的部署基础_

### 检查点 1
- [ ] 1.7 验证基础设施
  - 确保所有依赖正确安装
  - 确保数据库迁移成功执行
  - 确保前后端项目可以正常启动
  - 确保 Docker 容器可以正常构建和运行

---

## 阶段 2：核心数据模型和仓储层

### [并行组 2A] - 数据模型定义

- [ ] 2.1 定义 Go 数据模型
  - 实现 User 模型（包含 GORM 标签和 JSON 标签）
  - 实现 Product 模型
  - 实现 RedemptionOrder 模型
  - 实现 PointsTransaction 模型
  - 实现 ProductPriceHistory 模型
  - _需求: 1, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14_

### [并行组 2B] - 仓储层实现

- [ ] 2.2 实现 UserRepository
  - 实现用户 CRUD 操作
  - 实现按邮箱查询用户
  - 实现更新用户积分余额
  - 实现更新用户状态（离职）
  - _需求: 1, 2, 4, 5, 10, 11_

- [ ] 2.3 实现 ProductRepository
  - 实现产品 CRUD 操作
  - 实现查询已上架产品列表
  - 实现更新产品库存
  - 实现产品上下架操作
  - _需求: 3, 4, 9, 13_

- [ ] 2.4 实现 RedemptionOrderRepository
  - 实现订单 CRUD 操作
  - 实现按用户查询订单历史
  - 实现批量更新订单状态
  - 实现订单统计查询
  - _需求: 4, 6, 12, 14_

- [ ] 2.5 实现 PointsTransactionRepository
  - 实现积分交易记录创建
  - 实现按用户查询积分历史（分页）
  - 实现积分统计查询
  - _需求: 7, 10, 11, 14_

### 检查点 2
- [ ] 2.6 验证数据访问层
  - 编写并运行仓储层单元测试
  - 确保所有 CRUD 操作正常工作
  - 确保数据库约束正确生效

---

## 阶段 3：核心服务层（可并行开发）

### [并行组 3A] - 认证和用户服务

- [ ] 3.1 实现 AuthService
  - 实现密码加密（bcrypt）
  - 实现密码验证
  - 实现 JWT token 生成
  - 实现 JWT token 验证
  - 实现登录逻辑（包含首次登录积分发放）
  - _需求: 1, 2, 19.1_

- [ ] 3.2 实现 UserService
  - 实现创建员工账户（生成初始密码）
  - 实现修改手机号
  - 实现设置员工离职状态
  - 实现用户信息查询
  - _需求: 1_

### [并行组 3B] - 产品和库存服务

- [ ] 3.3 实现 ProductService
  - 实现产品创建（包含价格历史记录）
  - 实现产品更新（包含价格变更历史）
  - 实现产品上下架
  - 实现查询已上架产品列表
  - 实现批量导入产品（Markdown 表格解析）
  - _需求: 3, 9, 13_

### [并行组 3C] - 兑换服务

- [ ] 3.5 实现 RedemptionService
  - 实现兑换流程（积分验证、库存验证、事务处理）
  - 实现订单号生成
  - 实现兑换历史查询
  - 实现订单状态更新（单个和批量）
  - 实现兑换统计报表
  - _需求: 4, 6, 12, 14_

### [并行组 3D] - 积分服务

- [ ] 3.4 实现 PointsService
  - 实现积分发放（单个员工）
  - 实现积分扣除（带余额验证）
  - 实现批量积分发放（Markdown 表格解析）
  - 实现积分余额查询
  - 实现积分历史查询（分页）
  - 实现积分统计报表
  - _需求: 5, 7, 10, 11, 14, 19_

- [ ] 3.5 实现 RedemptionService
  - 实现兑换流程（积分验证、库存验证、事务处理）
  - 实现订单号生成
  - 实现兑换历史查询
  - 实现订单状态更新（单个和批量）
  - 实现兑换统计报表
  - _需求: 4, 6, 12, 14_

### 检查点 3
- [ ] 3.6 验证服务层
  - 编写并运行服务层单元测试
  - 确保所有业务逻辑正确实现
  - 确保事务处理正确（积分和库存一致性）

---

## 阶段 4：中间件和 API 层（可并行开发）

### [并行组 4A] - 中间件实现

- [ ] 4.1 实现认证中间件（AuthMiddleware）
  - 实现 JWT token 验证
  - 实现用户身份识别
  - 实现未认证请求拦截
  - _需求: 2_

- [ ] 4.2 实现角色中间件（RoleMiddleware）
  - 实现管理员权限验证
  - 实现未授权请求拦截
  - _需求: 1, 9, 10, 11, 12, 13, 14_

- [ ] 4.3 实现通用中间件
  - 实现 CORS 中间件
  - 实现日志中间件
  - 实现 Panic 恢复中间件
  - _需求: 所有 API 需求_

### [并行组 4B] - 认证和用户 API

- [ ] 4.4 实现 AuthHandler
  - POST /api/v1/auth/login（登录）
  - POST /api/v1/auth/logout（登出）
  - GET /api/v1/auth/me（获取当前用户信息）
  - _需求: 2_

- [ ] 4.5 实现 UserHandler
  - GET /api/v1/users/profile（获取个人信息）
  - PUT /api/v1/users/phone（修改手机号）
  - _需求: 1_

### [并行组 4C] - 产品和兑换 API

- [ ] 4.6 实现 ProductHandler
  - GET /api/v1/products（获取产品列表）
  - _需求: 3_

- [ ] 4.7 实现 RedemptionHandler
  - POST /api/v1/redemptions（创建兑换订单）
  - GET /api/v1/redemptions（获取兑换历史）
  - _需求: 4, 6_

### [并行组 4D] - 积分 API

- [ ] 4.8 实现 PointsHandler
  - GET /api/v1/points/balance（获取积分余额）
  - GET /api/v1/points/transactions（获取积分交易历史）
  - _需求: 5, 7_

### [并行组 4E] - 管理员 API

- [ ] 4.9 实现 AdminUserHandler
  - POST /api/v1/admin/users（创建员工账户）
  - PUT /api/v1/admin/users/:id/status（设置员工离职状态）
  - _需求: 1_

- [ ] 4.10 实现 AdminProductHandler
  - POST /api/v1/admin/products（创建产品）
  - PUT /api/v1/admin/products/:id（更新产品）
  - PUT /api/v1/admin/products/:id/status（上下架产品）
  - POST /api/v1/admin/products/batch（批量导入产品）
  - _需求: 9, 13_

- [ ] 4.11 实现 AdminPointsHandler
  - POST /api/v1/admin/points/grant（发放积分）
  - POST /api/v1/admin/points/deduct（扣除积分）
  - POST /api/v1/admin/points/batch-grant（批量发放积分）
  - _需求: 10, 11_

- [ ] 4.12 实现 AdminOrderHandler
  - GET /api/v1/admin/orders（获取所有订单）
  - PUT /api/v1/admin/orders/batch-status（批量更新订单状态）
  - _需求: 12_

- [ ] 4.13 实现 AdminReportHandler
  - GET /api/v1/admin/reports/points-grants（积分发放表）
  - GET /api/v1/admin/reports/points-balances（积分存量表）
  - GET /api/v1/admin/reports/redemptions（兑换记录表）
  - _需求: 14_

### 检查点 4
- [ ] 4.14 验证 API 层
  - 使用 Postman 或类似工具测试所有 API 端点
  - 确保认证和授权正确工作
  - 确保错误处理正确实现

---

## 阶段 5：前端页面开发（可并行开发）

### [并行组 5A] - 通用组件和服务

- [ ] 5.1 实现前端服务模块
  - 实现 apiService（Axios 封装，包含请求拦截器）
  - 实现 authService（token 管理，登录状态管理）
  - 实现 i18nService（语言切换）
  - 实现 storageService（本地存储管理）
  - _需求: 所有前端需求_

- [ ] 5.2 实现通用 UI 组件
  - 实现 Header 组件（导航、用户信息、语言切换）
  - 实现 ProductCard 组件
  - 实现 PointsBalance 组件
  - 实现 OrderStatusBadge 组件
  - 实现 DataTable 组件
  - 实现 ConfirmDialog 组件
  - 实现 NotificationToast 组件
  - 实现 MarkdownTableInput 组件
  - _需求: 3, 4, 5, 6, 9, 10, 12, 13, 14, 15_

### [并行组 5B] - 员工端页面

- [ ] 5.3 实现 LoginPage
  - 实现登录表单
  - 实现登录逻辑（调用 API）
  - 实现登录成功后的路由跳转
  - _需求: 2_

- [ ] 5.4 实现 ProductListPage
  - 实现产品列表展示（平铺布局）
  - 实现产品卡片（名称、图片、积分、库存状态）
  - 实现兑换按钮和确认对话框
  - 实现积分余额显示
  - _需求: 3, 4, 5_

- [ ] 5.5 实现 RedemptionHistoryPage
  - 实现兑换历史列表
  - 实现订单状态显示
  - 实现按时间倒序排列
  - _需求: 6_

- [ ] 5.6 实现 PointsHistoryPage
  - 实现积分历史列表（分页）
  - 实现变动类型和数量显示
  - 实现按时间倒序排列
  - _需求: 7_

- [ ] 5.7 实现 ProfilePage
  - 实现个人信息显示
  - 实现修改手机号功能
  - _需求: 1_

### [并行组 5C] - 管理员端页面

- [ ] 5.8 实现 AdminDashboardPage
  - 实现管理员仪表板布局
  - 实现快捷入口导航
  - _需求: 所有管理员需求_

- [ ] 5.9 实现 AdminUserManagementPage
  - 实现员工账户列表
  - 实现创建员工账户表单
  - 实现设置离职状态功能
  - _需求: 1_

- [ ] 5.10 实现 AdminProductManagementPage
  - 实现产品列表（包含上下架状态）
  - 实现创建/编辑产品表单
  - 实现上下架操作
  - 实现批量导入产品（Markdown 表格输入）
  - _需求: 9, 13_

- [ ] 5.11 实现 AdminPointsManagementPage
  - 实现积分发放表单（单个员工）
  - 实现积分扣除表单
  - 实现批量发放积分（Markdown 表格输入）
  - _需求: 10, 11_

- [ ] 5.12 实现 AdminOrderManagementPage
  - 实现订单列表
  - 实现订单状态筛选
  - 实现批量更新订单状态
  - _需求: 12_

- [ ] 5.13 实现 AdminReportsPage
  - 实现积分发放表
  - 实现积分存量表
  - 实现兑换记录表
  - 实现数据导出功能
  - _需求: 14_

### 检查点 5
- [ ] 5.14 验证前端功能
  - 测试所有页面的 UI 和交互
  - 测试响应式设计（桌面端和移动端）
  - 测试多语言切换
  - 确保所有 API 调用正确

---

## 阶段 6：集成测试和优化

### [串行任务] - 集成测试

- [ ] 6.1 端到端测试
  - 测试员工注册和首次登录流程
  - 测试产品浏览和兑换流程
  - 测试积分发放和扣除流程
  - 测试订单管理流程
  - 测试批量操作流程
  - _需求: 所有需求_

- [ ] 6.2 并发测试
  - 测试多用户同时兑换同一产品的库存竞争
  - 测试积分和库存的数据一致性
  - _需求: 4.5, 19_

- [ ] 6.3 性能测试
  - 测试页面加载时间
  - 测试 100 并发用户下的响应时间
  - 优化数据库查询和索引
  - _需求: 17_

### [串行任务] - 安全和错误处理

- [ ] 6.4 安全测试
  - 测试 JWT 认证和授权
  - 测试 SQL 注入防护
  - 测试 XSS 防护
  - 测试 CSRF 防护
  - _需求: 2, 所有管理员需求_

- [ ] 6.5 错误处理测试
  - 测试所有错误场景的提示信息
  - 测试数据验证和边界条件
  - 测试事务回滚
  - _需求: 所有需求_

### 检查点 6
- [ ] 6.6 最终验证
  - 确保所有需求都已实现
  - 确保所有测试通过
  - 确保系统性能达标
  - 确保系统安全性达标

---

## 阶段 7：部署和文档

### [并行组 7A] - 部署准备

- [ ] 7.1 配置生产环境
  - 配置生产数据库
  - 配置环境变量
  - 配置日志和监控
  - _需求: 18_

- [ ] 7.2 配置备份和恢复
  - 实施数据库备份策略
  - 测试数据恢复流程
  - _需求: 18_

### [并行组 7B] - 文档编写

- [ ] 7.3 编写部署文档
  - 编写部署步骤
  - 编写配置说明
  - 编写故障排查指南
  - _需求: 所有需求_

- [ ] 7.4 编写用户手册
  - 编写员工端使用手册
  - 编写管理员端使用手册
  - _需求: 所有需求_

### [串行任务] - 最终部署

- [ ] 7.5 生产环境部署
  - 部署后端服务
  - 部署前端应用
  - 配置 Nginx 反向代理
  - 执行数据库迁移
  - _需求: 所有需求_

- [ ] 7.6 生产环境验证
  - 验证所有功能正常工作
  - 验证系统性能
  - 验证系统可用性
  - _需求: 所有需求_

---

## 并行执行策略总结

### 阶段 1：2 个并行组（1A, 1B）
- 后端基础设施和前端基础设施可以同时进行

### 阶段 2：2 个并行组（2A, 2B）
- 数据模型定义和仓储层实现可以同时进行

### 阶段 3：4 个并行组（3A, 3B, 3C, 3D）
- 所有服务层组件相互独立，可以完全并行开发

### 阶段 4：5 个并行组（4A, 4B, 4C, 4D, 4E）
- 中间件和各个 API Handler 可以并行开发

### 阶段 5：3 个并行组（5A, 5B, 5C）
- 通用组件、员工端页面、管理员端页面可以并行开发

### 阶段 6：串行执行
- 集成测试需要所有功能完成后进行

### 阶段 7：2 个并行组（7A, 7B）+ 串行部署
- 部署准备和文档编写可以并行，最终部署需要串行

## 预估时间线

假设每个任务平均需要 1 个工作日：

- **串行执行**：约 70 个工作日
- **并行执行**（3-5 人团队）：约 25-30 个工作日
- **时间节省**：约 60%

## 注意事项

1. 每个阶段的检查点必须等待该阶段所有并行任务完成
2. 服务层和 API 层的并行开发需要提前定义好接口契约
3. 前端开发可以使用 Mock 数据先行开发，后期对接真实 API
4. 建议使用 Git 分支策略管理并行开发（feature branches）
5. 定期进行代码审查和集成，避免最后阶段出现大量冲突
