# AWSomeShop 测试清单

## 📋 测试前准备

### 环境要求
- ✅ Go 1.21+ 已安装
- ✅ Node.js 16+ 和 npm 已安装
- ✅ MySQL 8.0+ 已安装并运行
- ✅ Docker 和 Docker Compose（可选）

### 启动应用

#### 方式 1：手动启动
```bash
# 1. 启动 MySQL
docker run -d --name awsomeshop-mysql \
  -e MYSQL_ROOT_PASSWORD=root123 \
  -e MYSQL_DATABASE=awsomeshop \
  -p 3306:3306 mysql:8.0

# 2. 配置后端
cd backend
cp configs/config.yaml.example configs/config.yaml
# 编辑 config.yaml 设置数据库连接

# 3. 运行数据库迁移
mysql -u root -p awsomeshop < migrations/001_create_tables.sql

# 4. 启动后端
go run cmd/api/main.go

# 5. 启动前端（新终端）
cd frontend
npm install
cp .env.example .env
npm start
```

#### 方式 2：Docker Compose
```bash
docker-compose up -d
```

---

## 阶段 6.1：端到端功能测试

### 测试 1：员工注册和首次登录流程

#### 前置条件
- [ ] 创建管理员账户（参考 QUICK_START_GUIDE.md）
- [ ] 后端和前端服务正常运行

#### 测试步骤
1. [ ] 管理员登录系统
2. [ ] 进入"员工管理"页面
3. [ ] 创建新员工账户
   - 姓名：测试员工
   - 邮箱：test@example.com
   - 手机：1234567890
4. [ ] 记录生成的初始密码
5. [ ] 登出管理员账户
6. [ ] 使用员工账户登录
7. [ ] 验证首次登录获得 1000 积分
8. [ ] 验证积分余额显示正确

#### 预期结果
- ✅ 员工账户创建成功
- ✅ 初始密码自动生成
- ✅ 首次登录成功
- ✅ 积分余额显示 1000
- ✅ 积分历史中有"首次登录奖励"记录

---

### 测试 2：产品浏览和兑换流程

#### 前置条件
- [ ] 至少有一个员工账户（积分 ≥ 100）
- [ ] 至少有一个已上架产品（库存 > 0）

#### 测试步骤
1. [ ] 员工登录系统
2. [ ] 查看产品列表页面
3. [ ] 验证产品信息显示完整
   - 产品名称
   - 产品图片
   - 所需积分
   - 库存状态
4. [ ] 点击"兑换"按钮
5. [ ] 确认兑换对话框
6. [ ] 提交兑换
7. [ ] 验证兑换成功提示
8. [ ] 验证积分余额减少
9. [ ] 进入"兑换历史"页面
10. [ ] 验证订单记录存在
11. [ ] 进入"积分历史"页面
12. [ ] 验证积分扣除记录存在

#### 预期结果
- ✅ 产品列表正确显示
- ✅ 兑换流程顺畅
- ✅ 积分正确扣除
- ✅ 订单创建成功
- ✅ 历史记录正确

#### 边界测试
- [ ] 积分不足时无法兑换
- [ ] 库存为 0 时无法兑换
- [ ] 产品已下架时不显示

---

### 测试 3：积分发放和扣除流程

#### 前置条件
- [ ] 管理员账户已登录
- [ ] 至少有一个员工账户

#### 测试步骤 - 单个发放
1. [ ] 进入"积分管理"页面
2. [ ] 选择"发放积分"
3. [ ] 输入员工邮箱
4. [ ] 输入积分数量：500
5. [ ] 输入备注：测试发放
6. [ ] 提交发放
7. [ ] 验证成功提示
8. [ ] 切换到员工账户
9. [ ] 验证积分余额增加 500
10. [ ] 验证积分历史有发放记录

#### 测试步骤 - 批量发放
1. [ ] 进入"积分管理"页面
2. [ ] 选择"批量发放积分"
3. [ ] 输入 Markdown 表格：
```markdown
| 员工邮箱 | 积分数量 | 备注 |
|---------|---------|------|
| test1@example.com | 100 | 月度奖励 |
| test2@example.com | 200 | 季度奖励 |
```
4. [ ] 提交批量发放
5. [ ] 验证成功提示
6. [ ] 验证所有员工积分正确增加

#### 测试步骤 - 积分扣除
1. [ ] 进入"积分管理"页面
2. [ ] 选择"扣除积分"
3. [ ] 输入员工邮箱
4. [ ] 输入扣除数量：100
5. [ ] 输入备注：测试扣除
6. [ ] 提交扣除
7. [ ] 验证成功提示
8. [ ] 验证员工积分正确减少

#### 预期结果
- ✅ 单个发放成功
- ✅ 批量发放成功
- ✅ 积分扣除成功
- ✅ 所有操作都有历史记录
- ✅ 余额计算正确

#### 边界测试
- [ ] 扣除数量大于余额时失败
- [ ] 批量发放中有无效邮箱时部分成功
- [ ] Markdown 表格格式错误时提示

---

### 测试 4：订单管理流程

#### 前置条件
- [ ] 管理员账户已登录
- [ ] 系统中有多个订单（不同状态）

#### 测试步骤
1. [ ] 进入"订单管理"页面
2. [ ] 验证订单列表显示完整
   - 订单号
   - 员工信息
   - 产品信息
   - 积分数量
   - 订单状态
   - 创建时间
3. [ ] 测试状态筛选
   - [ ] 筛选"待处理"订单
   - [ ] 筛选"已发放"订单
   - [ ] 筛选"已取消"订单
4. [ ] 测试单个订单状态更新
   - [ ] 选择一个订单
   - [ ] 更新状态为"已发放"
   - [ ] 验证更新成功
5. [ ] 测试批量状态更新
   - [ ] 选择多个"待处理"订单
   - [ ] 批量更新为"已发放"
   - [ ] 验证所有订单状态更新

#### 预期结果
- ✅ 订单列表正确显示
- ✅ 状态筛选工作正常
- ✅ 单个更新成功
- ✅ 批量更新成功
- ✅ 状态变更有记录

---

### 测试 5：产品管理流程

#### 前置条件
- [ ] 管理员账户已登录

#### 测试步骤 - 创建产品
1. [ ] 进入"产品管理"页面
2. [ ] 点击"创建产品"
3. [ ] 填写产品信息
   - 名称：测试产品
   - 描述：这是一个测试产品
   - 图片 URL：https://example.com/image.jpg
   - 所需积分：100
   - 库存：50
4. [ ] 提交创建
5. [ ] 验证产品创建成功
6. [ ] 验证产品默认为"已上架"状态

#### 测试步骤 - 编辑产品
1. [ ] 选择一个产品
2. [ ] 点击"编辑"
3. [ ] 修改产品信息
   - 所需积分：150
   - 库存：100
4. [ ] 提交更新
5. [ ] 验证更新成功
6. [ ] 验证价格历史记录创建

#### 测试步骤 - 上下架
1. [ ] 选择一个产品
2. [ ] 点击"下架"
3. [ ] 验证状态更新为"已下架"
4. [ ] 切换到员工端
5. [ ] 验证产品不在列表中
6. [ ] 切换回管理员端
7. [ ] 点击"上架"
8. [ ] 验证状态更新为"已上架"

#### 测试步骤 - 批量导入
1. [ ] 点击"批量导入"
2. [ ] 输入 Markdown 表格：
```markdown
| 产品名称 | 描述 | 图片URL | 所需积分 | 库存 |
|---------|------|---------|---------|------|
| 产品A | 描述A | https://example.com/a.jpg | 100 | 50 |
| 产品B | 描述B | https://example.com/b.jpg | 200 | 30 |
```
3. [ ] 提交导入
4. [ ] 验证所有产品创建成功

#### 预期结果
- ✅ 产品创建成功
- ✅ 产品编辑成功
- ✅ 上下架功能正常
- ✅ 批量导入成功
- ✅ 价格历史记录正确

---

### 测试 6：统计报表功能

#### 前置条件
- [ ] 管理员账户已登录
- [ ] 系统中有足够的测试数据

#### 测试步骤 - 积分发放表
1. [ ] 进入"统计报表"页面
2. [ ] 选择"积分发放表"
3. [ ] 设置日期范围
4. [ ] 查看报表数据
5. [ ] 验证数据准确性
6. [ ] 点击"导出 CSV"
7. [ ] 验证文件下载成功

#### 测试步骤 - 积分存量表
1. [ ] 选择"积分存量表"
2. [ ] 查看所有员工积分余额
3. [ ] 验证数据准确性
4. [ ] 导出 CSV

#### 测试步骤 - 兑换记录表
1. [ ] 选择"兑换记录表"
2. [ ] 设置日期范围
3. [ ] 查看兑换记录
4. [ ] 验证数据准确性
5. [ ] 导出 CSV

#### 预期结果
- ✅ 所有报表数据准确
- ✅ 日期筛选工作正常
- ✅ CSV 导出成功
- ✅ 导出文件格式正确

---

### 测试 7：用户信息管理

#### 前置条件
- [ ] 员工账户已登录

#### 测试步骤
1. [ ] 进入"个人信息"页面
2. [ ] 查看个人信息显示
   - 姓名
   - 邮箱
   - 手机号
   - 积分余额
3. [ ] 点击"修改手机号"
4. [ ] 输入新手机号：9876543210
5. [ ] 提交修改
6. [ ] 验证修改成功
7. [ ] 刷新页面
8. [ ] 验证手机号已更新

#### 预期结果
- ✅ 个人信息正确显示
- ✅ 手机号修改成功
- ✅ 数据持久化正确

---

## 阶段 6.2：并发测试

### 测试 8：库存竞争测试

#### 目标
验证多用户同时兑换同一产品时，库存管理的正确性

#### 测试步骤
1. [ ] 创建一个产品，库存设置为 10
2. [ ] 创建 20 个员工账户，每个账户积分 1000
3. [ ] 使用测试工具模拟 20 个用户同时兑换该产品
4. [ ] 等待所有请求完成
5. [ ] 验证结果：
   - [ ] 只有 10 个兑换成功
   - [ ] 10 个兑换失败（库存不足）
   - [ ] 产品库存为 0
   - [ ] 成功兑换的员工积分正确扣除
   - [ ] 失败兑换的员工积分未扣除

#### 测试工具
可以使用以下工具进行并发测试：
- Apache JMeter
- Postman Collection Runner
- 自定义脚本（Go/Python）

#### 预期结果
- ✅ 库存管理正确
- ✅ 无超卖现象
- ✅ 积分扣除准确
- ✅ 事务处理正确

---

### 测试 9：积分一致性测试

#### 目标
验证积分发放和扣除的数据一致性

#### 测试步骤
1. [ ] 记录员工初始积分余额
2. [ ] 执行以下操作：
   - 发放积分 +500
   - 兑换产品 -100
   - 发放积分 +200
   - 扣除积分 -50
   - 兑换产品 -150
3. [ ] 计算预期余额
4. [ ] 查询实际余额
5. [ ] 验证余额一致
6. [ ] 查询积分历史
7. [ ] 验证所有交易记录存在
8. [ ] 验证交易记录总和等于余额变化

#### 预期结果
- ✅ 积分余额准确
- ✅ 交易记录完整
- ✅ 数据一致性保证

---

## 阶段 6.3：性能测试

### 测试 10：页面加载时间

#### 测试目标
- 首页加载时间 < 2 秒
- 产品列表加载时间 < 3 秒
- API 响应时间 < 500ms

#### 测试步骤
1. [ ] 使用浏览器开发者工具测量
2. [ ] 记录各页面加载时间
3. [ ] 记录 API 响应时间
4. [ ] 识别性能瓶颈

#### 优化建议
- [ ] 添加数据库索引
- [ ] 实现 API 响应缓存
- [ ] 优化图片加载
- [ ] 实现前端代码分割

---

### 测试 11：并发用户测试

#### 测试目标
系统应支持 100 并发用户

#### 测试步骤
1. [ ] 使用 JMeter 或类似工具
2. [ ] 模拟 100 并发用户
3. [ ] 执行常见操作：
   - 登录
   - 浏览产品
   - 兑换产品
   - 查看历史
4. [ ] 记录响应时间
5. [ ] 记录错误率
6. [ ] 监控服务器资源使用

#### 预期结果
- ✅ 平均响应时间 < 1 秒
- ✅ 错误率 < 1%
- ✅ 服务器资源使用合理

---

## 阶段 6.4：安全测试

### 测试 12：认证和授权

#### 测试步骤
1. [ ] 未登录访问受保护页面
   - 预期：重定向到登录页
2. [ ] 使用无效 token 访问 API
   - 预期：返回 401 Unauthorized
3. [ ] 使用过期 token 访问 API
   - 预期：返回 401 Unauthorized
4. [ ] 员工访问管理员 API
   - 预期：返回 403 Forbidden
5. [ ] 员工访问管理员页面
   - 预期：重定向到员工页面

#### 预期结果
- ✅ 认证机制工作正常
- ✅ 授权检查正确
- ✅ 无权限访问被拒绝

---

### 测试 13：输入验证

#### 测试步骤
1. [ ] SQL 注入测试
   - 在登录表单输入：`' OR '1'='1`
   - 预期：登录失败，无 SQL 错误
2. [ ] XSS 测试
   - 在产品名称输入：`<script>alert('XSS')</script>`
   - 预期：脚本被转义，不执行
3. [ ] 数据验证测试
   - 输入负数积分
   - 输入超长字符串
   - 输入特殊字符
   - 预期：所有无效输入被拒绝

#### 预期结果
- ✅ SQL 注入防护有效
- ✅ XSS 防护有效
- ✅ 输入验证完善

---

### 测试 14：密码安全

#### 测试步骤
1. [ ] 查看数据库中的密码字段
   - 预期：密码已加密（bcrypt）
2. [ ] 测试弱密码
   - 预期：系统接受（MVP 阶段无密码强度要求）
3. [ ] 测试密码验证
   - 输入错误密码
   - 预期：登录失败

#### 预期结果
- ✅ 密码加密存储
- ✅ 密码验证正确

---

## 阶段 6.5：错误处理测试

### 测试 15：网络错误处理

#### 测试步骤
1. [ ] 停止后端服务
2. [ ] 在前端执行操作
3. [ ] 验证错误提示友好
4. [ ] 重启后端服务
5. [ ] 验证系统恢复正常

#### 预期结果
- ✅ 网络错误有友好提示
- ✅ 不显示技术错误信息
- ✅ 系统可以恢复

---

### 测试 16：数据验证错误

#### 测试步骤
1. [ ] 测试各种无效输入
   - 空字段
   - 格式错误
   - 超出范围
2. [ ] 验证错误提示
3. [ ] 验证表单不提交

#### 预期结果
- ✅ 所有验证错误有提示
- ✅ 提示信息清晰
- ✅ 支持多语言

---

### 测试 17：业务逻辑错误

#### 测试步骤
1. [ ] 积分不足兑换
   - 预期：提示积分不足
2. [ ] 库存不足兑换
   - 预期：提示库存不足
3. [ ] 产品已下架兑换
   - 预期：无法兑换
4. [ ] 离职员工登录
   - 预期：登录失败

#### 预期结果
- ✅ 所有业务错误有提示
- ✅ 错误处理正确
- ✅ 数据保持一致

---

## 阶段 6.6：多语言测试

### 测试 18：语言切换

#### 测试步骤
1. [ ] 登录系统（默认中文）
2. [ ] 切换到英文
3. [ ] 验证所有文本翻译正确
4. [ ] 刷新页面
5. [ ] 验证语言设置保持
6. [ ] 切换回中文
7. [ ] 验证翻译正确

#### 预期结果
- ✅ 语言切换工作正常
- ✅ 所有文本都有翻译
- ✅ 语言设置持久化

---

## 阶段 6.7：响应式设计测试

### 测试 19：移动端测试

#### 测试步骤
1. [ ] 使用浏览器开发者工具
2. [ ] 切换到移动设备视图
3. [ ] 测试所有页面
   - 登录页面
   - 产品列表
   - 兑换历史
   - 积分历史
   - 个人信息
   - 管理员页面
4. [ ] 验证布局适配
5. [ ] 验证交互正常

#### 预期结果
- ✅ 所有页面移动端适配
- ✅ 布局不错乱
- ✅ 交互流畅

---

## 测试总结

### 测试完成标准

所有测试项目都应该通过，包括：
- ✅ 所有功能测试通过
- ✅ 并发测试通过
- ✅ 性能测试达标
- ✅ 安全测试通过
- ✅ 错误处理正确
- ✅ 多语言支持正常
- ✅ 响应式设计正确

### 发现的问题

记录测试过程中发现的所有问题：

| 编号 | 问题描述 | 严重程度 | 状态 | 修复说明 |
|-----|---------|---------|------|---------|
| 1   |         |         |      |         |
| 2   |         |         |      |         |

### 下一步

测试完成后，进入 **阶段 7：部署和文档**
